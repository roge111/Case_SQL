# üêç Python analytic
–¢—É—Ç —Å–æ–±—Ä–∞–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –∞–Ω–∞–ª–∏—Ç–µ–∫–µ –Ω–∞ Python. –ê —Ç–∞–∫ –∂–µ –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª

# üë®‚Äçüíª–†–µ—à–µ–Ω–∏–µ
–ù—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ—Ä—è–¥–æ–∫ —Ä–µ—à–µ–Ω–∏–π - —ç—Ç–æ –∏ –µ—Å—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á, –ø–æ—ç—Ç–æ–º—É —Ä–∞—Å—Å–∂–¥—É—Ç—å –Ω–∞ —Å—á–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç—É—Ç –æ—Å–æ–±–æ –∏ –Ω–µ –Ω–∞–¥–æ.

### ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
---

–í –¥–∞–Ω–Ω–æ–º —Ä–µ—à–µ–Ω–∏–∏ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:
- `pandas` - –±–∏–±–ª–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π. –û–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —É–¥–æ–±–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
- `random` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∏—Å–µ–ª. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è 0

###  –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫

```
import pandas as pd
import random as rd
```

–¢—É—Ç –º—ã –ø–æ–¥–∫–ª—é—á–∞–µ–º `pandas` –∏ –æ–±–æ–∑–Ω–∞—á–∞–µ–º –∫–∞–∫ `pd`. –¢–æ–∂–µ —Å–∞–º–æ–µ –∏ —Å `random` –∫–∞–∫ `rd`.

### –ó–∞–¥–∞–Ω–∏–µ 0

```
n = 100
count_n = 0

for i in range(n):
  for j in range(10):
    num = rd.randint(1, 9)
    if j == 9:
      if num == 8:
        count_n += 1
print(count_n/n)

```

–°–æ–≥–ª–∞—Å–Ω–æ –∑–∞–¥–∞–Ω–∏—é, —É –Ω–∞—Å 9 –≥—Ä–∞–Ω–µ–π. –¢–æ –µ—Å—Ç—å —É –Ω–∞—Å –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç 1 –¥–æ 9 –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ. –°–æ–≥–ª–∞—Å–Ω–æ —Ç–µ–æ—Ä–∏–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, —Ç–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–ø–∞–¥–µ–Ω–∏—è 8 –≤ –ª—é–±–æ–π –±—Ä–æ—Å–æ–∫ —Ä–∞–≤–Ω–∞ 1/9.
–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –º—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±—Ä–æ—Å–∫–∏ –∏ —Å—á–∏—Ç–∞–µ–º —á–∏—Å–ª–∞ 8, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø–æ–ª—É—á–µ–Ω—ã 10-–º –±—Ä–æ—Å–∫–æ–º,–Ω—É–ª–∏. –î–∞–ª–µ–µ –≤—ã—á–∏—Å–ª—è–µ–º —á–∞—Å—Ç–æ—Ç—É –≤—Å—Ç—Ä–µ—á 8 ‚Äî —ç—Ç–æ `count_n` –∏ –¥–µ–ª–∏–º –µ—ë –Ω–∞ `n` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–π. –¢–∞–∫ –º—ã –ø–æ–ª—É—á–∞–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—á–∏ 8.
–ò –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏—Ç–æ–≥ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–µ–Ω 1/9. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –æ—Ç–≤–µ—Ç –±—ã–ª 0.12.

### –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
---
```

""" –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤ """
def rename_col_df(df):

  return df.rename(columns={
      'Unnamed: 1': '–ü—Ä–µ–¥–º–µ—Ç',
      'Unnamed: 2': '–°–µ–∑–æ–Ω',
      'Unnamed: 3': '–ö–æ–ª–ª–µ–∫—Ü–∏—è',
      'Unnamed: 4': '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ',
      'Unnamed: 5': '–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞',
      'Unnamed: 6': '–†–∞–∑–º–µ—Ä',
      'Unnamed: 7': '–°–∫–ª–∞–¥',
      'Unnamed: 9' : '–ü–æ—Å—Ç—É–ø, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å',
      'Unnamed: 11': '–ó–∞–∫–∞–∑, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å',
      'Unnamed: 13': '–í—ã–∫—É–ø, —Ä—É–±–ª–∏',
      'Unnamed: 14':'–¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫'
  }).iloc[1:]

execl_file = '–î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è Python.xlsx'
df = pd.read_excel(execl_file, sheet_name= ['–û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ò–ü –ò–≤–∞–Ω–æ–≤', '–û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ò–ü –ü–µ—Ç—Ä–æ–≤', '–û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ò–ü –°–∏–¥–æ—Ä–æ–≤'])


df_ex1 =  pd.read_excel(execl_file, sheet_name='–ó–∞–¥–∞–Ω–∏–µ1')
df_ie_ivanov = rename_col_df(df['–û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ò–ü –ò–≤–∞–Ω–æ–≤']).rename(columns={'–û—Ç—á—ë—Ç –ø–æ –¥–∞–Ω–Ω—ã–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ ¬´–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–ü¬ª —Å 26.05.2022 –ø–æ 26.05.2022 —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω 27.05.2022 08:34:51. –°–∫–ª–∞–¥: –≤—Å–µ': '–ë—Ä–µ–Ω–¥'})
df_ie_petrov = rename_col_df(df['–û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ò–ü –ü–µ—Ç—Ä–æ–≤']).rename(columns={'–û—Ç—á—ë—Ç –ø–æ –¥–∞–Ω–Ω—ã–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ ¬´–ü–µ—Ç—Ä–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–ü¬ª —Å 26.05.2022 –ø–æ 26.05.2022 —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω 27.05.2022 08:35:54. –°–∫–ª–∞–¥: –≤—Å–µ': '–ë—Ä–µ–Ω–¥'})
df_ie_sidorov = rename_col_df(df['–û—Ç—á–µ—Ç –æ –ø—Ä–æ–¥–∞–∂–∞—Ö –ò–ü –°–∏–¥–æ—Ä–æ–≤']).rename(columns={'–û—Ç—á—ë—Ç –ø–æ –¥–∞–Ω–Ω—ã–º –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ ¬´–°–∏–¥–æ—Ä–æ–≤ –ê–Ω–∞—Ç–æ–ª–∏–π –ò–ü¬ª —Å 26.05.2022 –ø–æ 26.05.2022 —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω 27.05.2022 08:38:17. –°–∫–ª–∞–¥: –≤—Å–µ': '–ë—Ä–µ–Ω–¥'})
df_cost_price = pd.read_excel(execl_file, sheet_name='–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å')
df_guide =  pd.read_excel(execl_file, sheet_name='–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫')


```
–¢—É—Ç –º—ã —Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ –ª–∏—Å—Ç–∞–º —Å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ `execl_file`. –û–¥–Ω–∞–∫–æ –≤ —Å–≤—è–∑–∏ —Å —Ç–µ–º, —á—Ç–æ –≤ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ —É –Ω–∞—Å –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∂–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫, —Ç–æ –º—ã –≤–º–µ—Å—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–æ–ª—É—á–∞–µ–º `Unnamed: 1` –∏ —Ç.–¥.
–î–ª—è —ç—Ç–æ–≥–æ —è –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É —Å —Ç–∞–∫–æ–π –∫–æ–ª–æ–Ω–∫–æ–π –ø—Ä–æ–ø—É—Å—Ç–∏–ª —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `rename_col_df`, –∫–æ—Ç–æ—Ä–∞—è —Å –ø–æ–º–æ—â—å—é `rename` –æ—Ç `pandas` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç –≤—Å–µ `Unnamed: 1` –∏ —Ç.–¥. –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ. –ò —Ç–∞–∫ –≤—ã—à–ª–æ, —á—Ç–æ –Ω–∞ –ª–∏—Å—Ç–∞—Ö –æ–± –ò–ü —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ.
–í –∏—Ç–æ–≥–µ –º—ã –ø–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ:
- `df_ex1` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –∏–∑ –ª–∏—Å—Ç–∞ `–ó–∞–¥–∞–Ω–∏–µ 1`;
- `df_ie_ivanov` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –æ–± –ò–ü –ò–≤–∞–Ω–æ–≤–∞ –ò–≤–∞–Ω–∞. `ie` ‚Äî —ç—Ç–æ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ ¬´–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ¬ª;
- `df_ie_petrov` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –æ–± –ò–ü –ü–µ—Ç—Ä–æ–≤–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞;
- `df_ie_sidorov` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –æ–± –ò–ü –°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–∞—Ç–æ–ª–∏—è;
- `df_cost_price` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ ¬´–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å¬ª;
- `df_guide` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ ¬´–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫¬ª.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ò–ü –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –±—Ä–µ–Ω–¥–∞
---

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞ —è –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–º –∫–æ–ª–æ–Ω–∫—É —Å –±—Ä–µ–Ω–¥–æ–º, —á—Ç–æ–±—ã –±—ã–ª–æ –ª–µ–≥—á–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ, –∫ –∫–∞–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ –æ —á—å–µ–º –ò–ü –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞.

```
ie_ivanov, ie_petrov, ie_sidorov = set(df_ie_ivanov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']), set(df_ie_petrov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']), set(df_ie_sidorov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞'])

def check_ie(row):
  nomenclature = row['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']
  if nomenclature in ie_ivanov:
    return '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω'
  elif nomenclature in ie_petrov:
    return '–ü–µ—Ç—Ä–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä'
  elif nomenclature in ie_sidorov:
    return '–°–∏–¥–æ—Ä–æ–≤ –ê–Ω–∞—Ç–æ–ª–∏–π'
  

df_ex1['–ò–ü'] = df_ex1.apply(check_ie, axis=1)
df_ex1 = df_ex1.dropna(subset=['–ò–ü'])
```

–î–ª—è –Ω–∞—á–∞–ª–∞ –≤—ã–≤–µ–¥–µ–º —Å–ø–∏—Å–∫–∏ –ø–æ:
- `ie_ivanov` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `df_ie_ivanov`;
- `ie_petrov` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `df_ie_ivanov`;
- `ie_sidorov` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `df_ie_ivanov`.

–ü–æ–¥–æ–±–Ω–∞—è –∑–∞–ø–∏—Å—å, –∫–∞–∫ `df_ie_ivanov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']`, ‚Äî —ç—Ç–æ –º—ã –¥–æ—Å—Ç–∞–µ–º –∫–æ–ª–æ–Ω–∫—É —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏–∑ ¬´–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã¬ª –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `df_ie_ivanov`. –ò —Ç–∞–∫ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏.


–§—É–Ω–∫—Ü–∏—è `check_ie` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ —Ç–∞–±–ª–∏—Ü—ã. –í `nomenclature` —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–µ–∫—É—â–∞—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞. –ò –¥–∞–ª—å—à–µ —á–µ—Ä–µ–∑ `if` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –µ—ë –≤ –æ–¥–Ω–æ–º –∏–∑ —Å–ø–∏—Å–∫–æ–≤ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä. –ò –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ `ie_ivanov`, –∑–Ω–∞—á–∏—Ç –ò–ü ‚Äî –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω. –ò —Ç–∞–∫ –¥–∞–ª–µ–µ.

`df_ex1.apply(check_ie, axis=1)` ‚Äî —Ç—É—Ç –º—ã –ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é `check_ie` –ø–æ—Å—Ç—Ä–æ—á–Ω–æ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫—É `–ò–ü`. `axis=1` ‚Äî –∑–Ω–∞—á–∏—Ç, –º—ã –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–æ—Å—Ç—Ä–æ—á–Ω–æ, –∞ `axis=0` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º. 

–ó–∞—Ç–µ–º —á–µ—Ä–µ–∑ `dropna` - —É–¥–∞–ª—è—é —Ç–µ —Å—Ç—Ä–æ–∫–∏, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –ò–ü –Ω–µ –æ–ø—Ä–µ–¥–ª–µ–Ω.

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–µ
---

```
df_count_orders_ivanov = df_ie_ivanov.groupby('–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞').agg(
    –ó–∞–∫–∞–∑–∞–Ω–æ = ('–ó–∞–∫–∞–∑–∞–Ω–æ', 'sum'),
    –í—ã—Ä—É—á–∫–∞_—Å_WB = ('–ó–∞–∫–∞–∑, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å', 'sum')
).reset_index()

df_count_orders_petrov = df_ie_petrov.groupby('–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞').agg(
    –ó–∞–∫–∞–∑–∞–Ω–æ = ('–ó–∞–∫–∞–∑–∞–Ω–æ', 'sum'),
    –í—ã—Ä—É—á–∫–∞_–±–µ–∑_WB = ('–ó–∞–∫–∞–∑, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å', 'sum')
).reset_index()

df_count_orders_sidorov = df_ie_sidorov.groupby('–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞').agg(
    –ó–∞–∫–∞–∑–∞–Ω–æ = ('–ó–∞–∫–∞–∑–∞–Ω–æ', 'sum'),
    –í—ã—Ä—É—á–∫–∞_—Å_WB = ('–ó–∞–∫–∞–∑, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å', 'sum')
).reset_index()
```
–ó–¥–µ—Å—å —è –∫–∞–∂–¥—É—é —Ç–∞–±–ª–∏—Ü—É –æ–± –ò–ü –≥—Ä—É–ø–ø–∏—Ä—É—é –ø–æ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–µ. –ò —Ç–µ–º —Å–∞–º—ã–º —É –º–µ–Ω—è –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ–ø–µ—Ä–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–º–µ–Ω–∫–∞—Ç—É—Ä—É. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç, —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –Ω–µ –æ–¥–∏–Ω —Ä–∞–∑.

`agg` - —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫—É—é –∫–æ–ª–æ–Ω–∫—É —è –æ—Å—Ç–∞–≤–ª—è—é –∏ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —è –≥—Ä—É–ø–ø–∏—Ä—É—é. –í –¥–∞–Ω–Ω–æ–º–µ —Å–ª—É—á–∞–µ —è –æ—Å—Ç–∞–≤–ª—è—é —Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏: `–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞`, `–ó–∞–∫–∞–∑–∞–Ω–æ`, `–í—ã—Ä—É—á–∫–∞_–±–µ–∑_WB`.

- `–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞` - —Ç—É—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞
- `–ó–∞–∫–∞–∑–∞–Ω–æ` - —Ç—É—Ç —è —Ö—Ä–∞–Ω—é –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤. –¢–æ –µ—Å—Ç—å —Å—É–º–º—É –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –æ–¥–Ω–æ–π –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã
- `–í—ã—Ä—É—á–∫–∞_–±–µ–∑_WB` - —Ç—É—Ç —è –ø–æ–ª—É—á–∞—é —Å—É–º–º—É –≤—ã—Ä—É—á–∫–∏ –±–µ–∑ –∫–æ–º–º–∏—Å—Å–∏–∏ WB = 17%

### –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤ –∏ –≤—ã—Ä—É—á–∫–æ–π
---

```
def count_orders_revenue_nomenclature(row, flag):
  if flag == '–ó–∞–∫–∞–∑':
    name_value = '–ó–∞–∫–∞–∑–∞–Ω–æ'
    k = 1
  elif flag == '–í—ã—Ä—É—á–∫–∞':
    name_value = '–í—ã—Ä—É—á–∫–∞_–±–µ–∑_WB'
    k = 1/0.83
  else:
    return '–ù–µ –≤–µ—Ä–Ω—ã–π —Ñ–ª–∞–≥ —Ä–∞—Å—á–µ—Ç–∞'

  nomenclature = row['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']


  if nomenclature in ie_ivanov:
    return df_count_orders_ivanov[df_count_orders_ivanov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞'] == nomenclature][name_value].iloc[0]*k
  elif nomenclature in ie_petrov:
    return df_count_orders_petrov[df_count_orders_petrov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞'] == nomenclature][name_value].iloc[0]*k
  elif nomenclature in ie_sidorov:
    return df_count_orders_sidorov[df_count_orders_sidorov['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞'] == nomenclature][name_value].iloc[0]*k
  else:
    return 0

df_ex1['–ó–∞–∫–∞–∑—ã, —à—Ç.'] = df_ex1.apply(count_orders_revenue_nomenclature, flag = '–ó–∞–∫–∞–∑', axis=1)
df_ex1['–í—ã—Ä—É—á–∫–∞, —Ä—É–±.'] = df_ex1.apply(count_orders_revenue_nomenclature, flag = '–í—ã—Ä—É—á–∫–∞', axis=1)
```

–§—É–Ω–∫—Ü–∏—è `count_order_revenue_nomenclature` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∏ —Ñ–ª–∞–≥ `flag`, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ —Ç–æ, —á—Ç–æ –º—ã —Å—á–∏—Ç–∞–µ–º. 

–ï—Å–ª–∏ `flag` = '–ó–∞–∫–∞–∑', —Ç–æ –º—ã –∑–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–∫–∞–∑–æ–≤, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏, –æ—Ç–∫—É–¥–∞ –±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ `name_value` = '–ó–∞–∫–∞–∑–∞–Ω–æ' –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç `k` = 1. –ï—Å–ª–∏ `flag` = '–í—ã—Ä—É—á–∫–∞',
–º—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `name_value` = '–í—ã—Ä—É—á–∫–∞_–±–µ–∑_WB' –∏ k = 1/0.83. –í —É—Å–ª–æ–≤–∏–∏ –¥–∞–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —á—Ç–æ —É –Ω–∞—Å –≤ (–ó–∞–∫–∞–∑–∞–Ω–æ, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å) —É–∫–∞–∑–∞–Ω–∞ –≤—ã—Ä—É—á–∫–∞ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏ 17%.

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏
```
categories_cost_price = set(df_cost_price['–ö–∞—Ç–µ–≥–æ—Ä–∏—è'])
minimum = df_cost_price['–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã, —Ä—É–±./—à—Ç.'].min()
def profit(row, minimum):
  nomenclature = row['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞']
  ie = row['–ò–ü']

  catrogory = df_guide[df_guide['–ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞'] == nomenclature]['–ö–∞—Ç–µ–≥–æ—Ä–∏—è'].iloc[0]
  if catrogory not in categories_cost_price:
    fix_price = minimum
  else:
    fix_price = df_cost_price[df_cost_price['–ö–∞—Ç–µ–≥–æ—Ä–∏—è'] == catrogory]['–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã, —Ä—É–±./—à—Ç.'].iloc[0]
  revenue = row['–í—ã—Ä—É—á–∫–∞, —Ä—É–±.']
  count_orders = row['–ó–∞–∫–∞–∑—ã, —à—Ç.']


  if nomenclature in ie_ivanov:
    tax = 0.01
  elif nomenclature in ie_petrov:
    tax = 0.03
  elif nomenclature in ie_sidorov:
    tax = 0.05
  else:
    return 0
  prof = revenue - (fix_price*count_orders + revenue*tax + revenue*0.17)
  return prof

df_ex1['–ü—Ä–∏–±—ã–ª—å, —Ä—É–±.'] = df_ex1.apply(profit, minimum = minimum, axis=1)
```

–¢—É—Ç `categories_cost_place` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, `minimum` ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ñ–∏–∫—Å. —Ü–µ–Ω–∞.

–§—É–Ω–∫—Ü–∏—è `profit` –≤—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–∏–±—ã–ª—å. –°–Ω–∞—á–∞–ª–∞ –º—ã –≤—ã—á–∏—Å–ª–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–µ–∫—É—â–µ–π –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã. –ò –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Ç–æ –±–µ—Ä–µ–º —Ñ–∏–∫—Å. —Ü–µ–Ω—É, —Å–≤–µ—Ä–∏–≤, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã ¬´–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å¬ª —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã. 

–î–∞–ª–µ–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—ã—Ä—É—á–∫—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤. –ò –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∫ –∫–∞–∫–æ–º—É –ò–ü –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ –≤ `if`, —Å—Ç–∞–≤—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –Ω–∞–ª–æ–≥.

–í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–∏–±—ã–ª—å –∫–∞–∫ —Ä–∞–∑–Ω–∏—Ü—É –∏–∑ –≤—ã—Ä—É—á–∫–∏ –∏ —Å—É–º–º—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ñ–∏–∫—Å. —Ü–µ–Ω—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ + –≤—ã—Ä—É—á–∫–∞ —Å —É—á–µ—Ç–æ–º –Ω–∞–ª–æ–≥–∞ + –≤—ã—Ä—É—á–∫–∞ —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–∏.
`prof = revenue - (fix_price*count_orders + revenue*tax + revenue*0.17)`

–ö–∞–∫ —Å–∫–∞–∑–∞–Ω–æ –≤ –∑–∞–¥–∞—á–µ: `–ù–∞–ª–æ–≥ –∏ –∫–æ–º–∏—Å—Å–∏—è –±–µ—Ä—É—Ç—Å—è –æ—Ç –≤—ã—Ä—É—á–∫–∏`. –¢–∞–∫ —Ç—É—Ç –∏ —Å–¥–µ–ª–∞–Ω–æ. –≠—Ç–æ —É –Ω–∞—Å –∑–∞—Ç—Ä–∞—Ç—ã: `(fix_price * count_orders + revenue * tax + revenue * 0.17)`. –ó–∞–≤—Ç—Ä–∞—Ç—ã –ø–æ —Ñ–∏–∫—Å. —Ü–µ–Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞. –í–µ–¥—å —É–∫–∞–∑–∞–Ω–∞ —Ñ–∏–∫—Å. —Ü–µ–Ω–∞ –∑–∞ 1 —à—Ç.
–ï—Å–ª–∏ –ø—Ä–∏–±—ã–ª—å –º–µ–Ω—å—à–µ –Ω—É–ª—è, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ–ª—å.

### –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏
```
def profitability(row):
  revenue = row['–í—ã—Ä—É—á–∫–∞, —Ä—É–±.']
  profit = row['–ü—Ä–∏–±—ã–ª—å, —Ä—É–±.']

  if revenue == 0:–°–æ—Ö—Ä–∞–Ω–∏–º –≤ —Ñ–∞–π–ª, –∫–∞–∫ –Ω–∞—Å –ø—Ä–æ—Å—è—Ç.

### –°–æ–∑–¥–∞—ë–º —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.
  return round(profit/revenue * 100, 4)

df_ex1['–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, %'] = df_ex1.apply(profitability, axis=1)

```

`–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å` - —ç—Ç–æ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏—ã–ª–∏ –∫ –≤—ã—Ä—É—á–∫–µ. 

### –°–æ–∑—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª

```
df_ex1.to_excel("–ó–∞–¥–∞–Ω–∏–µ 1.xlsx", sheet_name="–¢–∞–±–ª–∏—Ü–∞", index=False)
```

–°–æ—Ö—Ä–∞–Ω–∏–º –≤ —Ñ–∞–π–ª, –∫–∞–∫ –Ω–∞—Å –ø—Ä–æ—Å—è—Ç

### –°–æ–∑–¥–∞—ë–º —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É

```
pivot_table = (
    df_ex1.pivot_table(
        index = '–ò–ü',
        values=['–ó–∞–∫–∞–∑—ã, —à—Ç.', '–í—ã—Ä—É—á–∫–∞, —Ä—É–±.', '–ü—Ä–∏–±—ã–ª—å, —Ä—É–±.'],
        aggfunc='sum'
    )
    .rename(columns={
        '–ó–∞–∫–∞–∑—ã, —à—Ç.': '–°—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤, —à—Ç',
        '–í—ã—Ä—É—á–∫–∞, —Ä—É–±.': '–°—É–º–º–∞ –≤—ã—Ä—É—á–∫–∏, —Ä—É–±',
        '–ü—Ä–∏–±—ã–ª—å, —Ä—É–±.': '–°—É–º–º–∞ –ø—Ä–∏–±—ã–ª–∏, —Ä—É–±'
    })
    .reset_index()  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –≤ –æ–±—ã—á–Ω—É—é –∫–æ–ª–æ–Ω–∫—É
)

pivot_table.index = ['–ò–ü'] * len(pivot_table)

# pivot_table.column = ['–°—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤, —à—Ç', '–°—É–º–º–∞ –≤—ã—Ä—É—á–∫–∏, —Ä—É–±', '–°—É–º–º–∞ –ø—Ä–∏–±—ã–ª–∏, —Ä—É–±']
                                                                  
pivot_table
```

# –ü—Ä–æ—â–∞–Ω–∏–µ üëã

–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–∞–º–∞–Ω–∏–µ! –ù–∞–¥–µ—é—Å—å, –±—ã–ª–æ –∏–Ω–µ—Ç–µ—Ä—Å–Ω–æ



